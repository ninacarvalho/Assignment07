<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ITC5202 - Assignment 07</title>
</head>
<body>
  <h1>Weather of Toronto</h1>
  <button type="button" onclick="displayWeather()">Display the Weather</button>
  <div id="output"></div>
  <br>
  <div id="iconDiv"></div>

  <div id="weatherInfo"></div>

  <script>
    const apiUrl = 'https://api.openweathermap.org/data/2.5/weather?q=Toronto&appid=b1aa5572eb3d44bf18cc164206c82c16&units=metric';
    const apiUrlFr = apiUrl + '&lang=fr';

    let weather;
    let weatherFr;
    let icon;

    const outputElement = document.getElementById('output');
    const weatherInfoElement = document.getElementById('weatherInfo');

    function getIconUrl(icon) {
      return `https://openweathermap.org/img/wn/${icon}@2x.png`;
    }

    function fetchWeatherData(url) {
      return fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .catch(error => {
          console.error('Error fetching weather data:', error);
        });
    }

    Promise.all([fetchWeatherData(apiUrl), fetchWeatherData(apiUrlFr)])
      .then(data => {
        weather = new Weather(data[0]);
        weatherFr = new Weather(data[1]);
      });
    

     
    function displayWeather() {
      checkWeatherDataValidity();
      const windSpeed = `wind speed: ${weather.wind.speed}`;
      const weatherDescription = `Description: ${weather.weather.main}, ${weather.weather.description}`;
      const weatherDescriptionFr = `Description (FR): ${weatherFr.weather.main}, ${weatherFr.weather.description}`;
      const icon = weather.weather.icon;

      const temperatureInfo = `Feels like: ${weather.main.feels_like}Â°C`;

      iconDiv.innerHTML = `<img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="weather icon" />`;

      weatherInfoElement.innerHTML = `
        <p>${windSpeed}</p>
        <p>${weatherDescription}</p> 
        <p>${weatherDescriptionFr}</p>
        <p>${temperatureInfo}</p>`;
    }

    class Weather {
      constructor(json) {
        this.weather = json.weather[0];
        this.base = json.base;
        this.main = json.main;
        this.visibility = json.visibility;
        this.wind = json.wind;
        this.clouds = json.clouds;
        this.dt = json.dt;
        this.sys = json.sys;
        this.timezone = json.timezone;
        this.id = json.id;
        this.name = json.name;
        this.cod = json.cod;
      }
    }

    function checkWeatherDataValidity() {
      if (!weather) {
        outputElement.textContent = 'loading, try again';
        return false;
      }
      outputElement.textContent = '';
      return true;
    }

  </script>
</body>
</html>
